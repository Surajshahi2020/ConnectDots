<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CyberPulse</title>
  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script> -->
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"> -->

  <link href="../static/css/bootstrap.min.css" rel="stylesheet">
  <link href="../static/css/all.min.css" rel="stylesheet">
  <script src="../static/js/boostrap.bundle.min.js"></script>

  <style>
    :root {
      --sidebar-width: 260px;
      --footer-height: 120px; /* Match actual footer height */
    }
    body {
      margin: 0;
      background-color: #f8fafc;
      overflow-x: hidden;
    }
    .main-navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1050;
      background: linear-gradient(135deg, #6479d4 0%, #5f2598 100%) !important;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      height: 60px;
    }
    .main-sidebar {
      position: fixed;
      top: 60px;
      left: 0;
      width: var(--sidebar-width);
      height: calc(100vh - 60px);
      background: #1e293b;
      color: white;
      z-index: 1000;
      overflow-y: auto;
      transition: transform 0.3s ease;
    }
    .main-sidebar.collapsed {
      transform: translateX(calc(-1 * var(--sidebar-width) + 70px));
    }

    /* âœ… SCROLLABLE CONTENT AREA */
    .main-content {
      margin-left: var(--sidebar-width);
      margin-top: 48px;
      padding: 20px;
      padding-bottom: calc(var(--footer-height) + 20px); /* Space for fixed footer */
      transition: margin-left 0.3s;
      /* Scroll only this area if content overflows */
      max-height: calc(100vh - 60px);
      overflow-y: auto;
    }
    .main-sidebar.collapsed ~ .main-content {
      margin-left: 70px;
    }

    /* âœ… FIXED FOOTER */
   .fixed-footer {
        position: fixed;
        bottom: 0;
        left: var(--sidebar-width);
        right: 0;
        height: 70px; /* Reduced from your original var(--footer-height) */
        background: #222;
        color: #ccc;
        z-index: 1040;
        padding: 0 20px;
        transition: left 0.3s;
    }

    .main-sidebar.collapsed ~ .fixed-footer {
      left: 70px;
    }

    .sidebar-toggle {
      background: #334155;
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
    }
    .sidebar-toggle:hover {
      background: #475569;
    }
    .nav-link {
      color: #cbd5e1;
      font-weight: 500;
    }
    .nav-link:hover, .nav-link.active {
      background: rgba(255,255,255,0.1);
      color: white;
    }
    .nav-icon { min-width: 32px; }
    .sidebar-text { transition: opacity 0.2s; }
    .main-sidebar.collapsed .sidebar-text {
      opacity: 0;
      width: 0;
      margin: 0;
      overflow: hidden;
    }
    .info-box {
      border-radius: 10px;
      padding: 20px;
      color: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-top: 24px;
    }
    .card {
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: none;
    }
  </style>
</head>
<body>

  <!-- ðŸ” NAVBAR -->
<nav class="main-navbar navbar navbar-expand navbar-dark bg-gradient-primary px-3 py-2 shadow-sm">
  <div class="container-fluid">
    <!-- Left Side: Toggle & Brand -->
    <div class="d-flex align-items-center">
      <button class="sidebar-toggle btn btn-light btn-sm me-3" id="sidebarToggle">
        <i class="fas fa-bars"></i>
      </button>
      <a class="navbar-brand d-flex align-items-center fw-bold text-white text-decoration-none" href="{% url 'dashboard' %}">
        <i class="fas fa-link me-2 fs-4"></i>
        <span class="fs-5">Connect The Dot</span>
      </a>
    </div>

    <!-- Right Side: User Menu -->
    <div class="navbar-nav ms-auto">
      <div class="nav-item dropdown">
        <button class="btn btn-outline-light btn-sm dropdown-toggle d-flex align-items-center" 
                type="button" 
                id="userDropdown" 
                data-bs-toggle="dropdown" 
                aria-expanded="false">
          <div class="d-flex align-items-center">
            <div class="me-2">
              <i class="fas fa-user-circle fs-5"></i>
            </div>
            <div class="d-none d-md-block text-start">
              <div class="fw-semibold small">{{ request.session.user_username }}</div>
              <div class="x-small opacity-75">{{ request.session.user_rank }}</div>
            </div>
          </div>
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2" aria-labelledby="userDropdown">
          <li class="dropdown-header">
            <div class="d-flex align-items-center">
              <div class="me-2">
                <i class="fas fa-user-circle text-primary fs-4"></i>
              </div>
              <div class="user-details">
      <div class="user-name fw-semibold text-dark">
        {{ request.session.user_username }}
      </div>
      <div class="user-role text-primary small fw-medium">
        {{ request.session.user_role|default:"User" }}
      </div>
      <div class="user-rank text-muted x-small">
        <i class="fas fa-shield-alt me-1"></i>{{ request.session.user_rank|default:"Member" }}
      </div>
    </div>
            </div>
          </li>
          <li><hr class="dropdown-divider my-2"></li>
          <li>
            <a class="dropdown-item d-flex align-items-center py-2" href="{% url 'password_change' %}">
              <div class="icon-wrapper bg-primary bg-opacity-10 text-primary rounded-circle p-2 me-3">
                <i class="fas fa-key"></i>
              </div>
              <div>
                <div class="fw-medium">Change Password</div>
                <div class="x-small text-muted">Update your account password</div>
              </div>
            </a>
          </li>
          <li><hr class="dropdown-divider my-2"></li>
          <li>
            <a class="dropdown-item d-flex align-items-center py-2 text-danger" href="{% url 'logout' %}">
              <div class="icon-wrapper bg-danger bg-opacity-10 text-danger rounded-circle p-2 me-3">
                <i class="fas fa-sign-out-alt"></i>
              </div>
              <div>
                <div class="fw-medium">Logout</div>
                <div class="x-small text-muted">Sign out of your account</div>
              </div>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<!-- Custom CSS for navbar -->
<style>
.main-navbar {
  background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
  min-height: 60px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.navbar-brand:hover {
  opacity: 0.9;
}

.sidebar-toggle {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.sidebar-toggle:hover {
  background-color: #e9ecef;
  transform: scale(1.05);
}

#userDropdown {
  border-radius: 8px;
  padding: 6px 12px;
  border: 1px solid rgba(255, 255, 255, 0.3);
  transition: all 0.3s ease;
}

#userDropdown:hover {
  background-color: rgba(255, 255, 255, 0.1);
  border-color: rgba(255, 255, 255, 0.5);
}

.dropdown-menu {
  border-radius: 10px;
  border: 1px solid #e0e0e0;
  min-width: 280px;
}

.dropdown-header {
  padding: 12px 16px;
  background-color: #f8f9fa;
  border-radius: 10px 10px 0 0;
}

.icon-wrapper {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.dropdown-item {
  border-radius: 6px;
  margin: 2px 8px;
  transition: all 0.2s ease;
}

.dropdown-item:hover {
  background-color: #f0f7ff;
  transform: translateX(2px);
}

.dropdown-item.text-danger:hover {
  background-color: #fff5f5;
}

.x-small {
  font-size: 0.75rem;
}

@media (max-width: 768px) {
  .navbar-brand span {
    font-size: 1.1rem;
  }
  
  #userDropdown .d-none {
    display: block !important;
  }
  
  #userDropdown .text-start div:first-child {
    font-size: 0.9rem;
  }
  
  #userDropdown .text-start div:last-child {
    font-size: 0.7rem;
  }
}
</style>

  <!-- ðŸ§­ SIDEBAR -->
  <aside class="main-sidebar" id="mainSidebar">
    <div class="p-3 pt-4 border-bottom border-secondary">
      <div class="d-flex align-items-center">
        <i class="fas fa-shield-alt fa-lg"></i>
        <span class="sidebar-text ms-2 fw-bold">Investigation</span>
      </div>
      <!-- <div class="mt-2 sidebar-text">
        <div>{{ user.get_full_name|default:user.username }}</div>
        <div class="text-muted small">{{ role_display }}</div>
      </div> -->
    </div>
    {% include 'sidebar_menu.html' %}
  </aside>

  <!-- âœ… SCROLLABLE MAIN CONTENT -->
  <main class="main-content">
    {% block content %}{% endblock %}
  </main>

  <!-- âœ… FIXED FOOTER (never scrolls) -->
  <footer class="fixed-footer">
    <div class="container h-100 d-flex flex-column justify-content-center">
      <div class="row align-items-center">
        <div class="col-md-4 mb-2 mb-md-0">
          <div class="d-flex align-items-center">
            <i class="fas fa-shield-alt fa-lg me-2 text-primary"></i>
            <span class="h6 mb-0">CyberPulse</span>
          </div>
        </div>
        <div class="col-md-4 text-center mb-2 mb-md-0">
          <small>&copy; <span id="current-year"></span> CyberPulse. All rights reserved.</small>
        </div>
        <div class="col-md-4 text-md-end">
          <span class="badge bg-danger small">CLASSIFIED: SECRET</span>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col-12 text-center">
          <small class="text-muted">
            <i class="fas fa-exclamation-triangle me-1"></i>
            Authorized personnel only. Unauthorized access prohibited.
          </small>
        </div>
      </div>
    </div>
  </footer>

  <script>
    document.getElementById('current-year').textContent = new Date().getFullYear();

    document.addEventListener('DOMContentLoaded', () => {
      const sidebar = document.getElementById('mainSidebar');
      const toggle = document.getElementById('sidebarToggle');

      if (localStorage.getItem('sidebarCollapsed') === 'true') {
        sidebar.classList.add('collapsed');
      }

      toggle?.addEventListener('click', () => {
        sidebar.classList.toggle('collapsed');
        localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
      });
    });
  </script>
  
{% include 'sweet_alert.html' %}
</body>
</html>